# Insecure url.parse()

## Description

Since insecure `url.parse()` usage is deprecated (DEP0169) and has reached Application deprecation status, we should provide a codemod to replace it.

- The codemod should replace `url.parse()` with `new URL()` for secure URL parsing.
- The codemod should handle the different return value structure between the two APIs.
- The codemod should handle both CommonJS and ESM imports.
- The codemod should preserve query string parsing behavior where needed.

## Additional Information

Note that insecure `url.parse()` usage was deprecated in Node.js v24.0.0 as an Application deprecation. The `url.parse()` function has security vulnerabilities and inconsistent behavior compared to the WHATWG URL Standard. Instead of `url.parse()`, developers should use `new URL()` which provides a more secure and standards-compliant way to parse URLs.

The `url.parse()` function can be exploited for security vulnerabilities like host header injection and has inconsistent handling of edge cases compared to modern URL parsing standards.

## Examples

### Example 1: Basic URL parsing

**Before:**

```js
const url = require("node:url");
const parsed = url.parse("https://example.com/path?query=value");
console.log(parsed.hostname, parsed.pathname);
```

**After:**

```js
const parsed = new URL("https://example.com/path?query=value");
console.log(parsed.hostname, parsed.pathname);
```

### Example 2: URL parsing with query string parsing

**Before:**

```js
const url = require("node:url");
const parsed = url.parse("https://example.com/search?q=test&page=1", true);
console.log(parsed.query.q, parsed.query.page);
```

**After:**

```js
const parsed = new URL("https://example.com/search?q=test&page=1");
console.log(parsed.searchParams.get("q"), parsed.searchParams.get("page"));
```

### Example 3: Destructuring parsed URL

**Before:**

```js
const url = require("node:url");
const { protocol, hostname, port, pathname } = url.parse("https://example.com:8080/api");
```

**After:**

```js
const parsed = new URL("https://example.com:8080/api");
const { protocol, hostname, port, pathname } = parsed;
```

### Example 4: Relative URL resolution

**Before:**

```js
const url = require("node:url");
const resolved = url.resolve("https://example.com/base/", "../other/path");
```

**After:**

```js
const resolved = new URL("../other/path", "https://example.com/base/").href;
```

### Example 5: ESM import usage

**Before:**

```js
import { parse } from "node:url";
const parsed = parse("https://api.example.com/v1/users");
```

**After:**

```js
const parsed = new URL("https://api.example.com/v1/users");
```

### Example 6: Function with URL parsing

**Before:**

```js
const url = require("node:url");
function extractHost(urlString) {
  const parsed = url.parse(urlString);
  return parsed.hostname;
}
```

**After:**

```js
function extractHost(urlString) {
  try {
    const parsed = new URL(urlString);
    return parsed.hostname;
  } catch (error) {
    return null;
  }
}
```

## Refs

- [DEP0169: Insecure `url.parse()`](https://nodejs.org/api/deprecations.html#dep0169)