# fs.truncate() using a file descriptor

## Description

Since `fs.truncate()` using a file descriptor is deprecated (DEP0081) and has reached End-of-Life status, we should provide a codemod to replace it.

- The codemod should replace `fs.truncate(fd, len, callback)` with `fs.ftruncate(fd, len, callback)`.
- The codemod should handle both sync and async versions of the function.
- The codemod should handle both CommonJS and ESM imports.
- The codemod should preserve error handling and callback patterns.

## Additional Information

Note that `fs.truncate()` using a file descriptor was deprecated and reached End-of-Life status in Node.js v24.0.0. The function was deprecated because using a file descriptor with `fs.truncate()` was confusing and inconsistent with the function's primary purpose of truncating files by path. Instead of using `fs.truncate()` with a file descriptor, developers should use `fs.ftruncate()`.

The `fs.truncate()` function should only be used with file paths, while `fs.ftruncate()` is specifically designed for file descriptors and provides clearer semantics.

## Examples

### Example 1: Basic file descriptor truncation

**Before:**

```js
const fs = require("node:fs");
fs.open("file.txt", "r+", (err, fd) => {
  if (err) throw err;
  fs.truncate(fd, 10, (err) => {
    if (err) throw err;
    fs.close(fd, () => {});
  });
});
```

**After:**

```js
const fs = require("node:fs");
fs.open("file.txt", "r+", (err, fd) => {
  if (err) throw err;
  fs.ftruncate(fd, 10, (err) => {
    if (err) throw err;
    fs.close(fd, () => {});
  });
});
```

### Example 2: Synchronous truncation

**Before:**

```js
const fs = require("node:fs");
const fd = fs.openSync("data.txt", "r+");
fs.truncateSync(fd, 100);
fs.closeSync(fd);
```

**After:**

```js
const fs = require("node:fs");
const fd = fs.openSync("data.txt", "r+");
fs.ftruncateSync(fd, 100);
fs.closeSync(fd);
```

### Example 3: Promise-based truncation

**Before:**

```js
const fs = require("node:fs").promises;
async function truncateFile(fd, length) {
  await fs.truncate(fd, length);
}
```

**After:**

```js
const fs = require("node:fs").promises;
async function truncateFile(fd, length) {
  await fs.ftruncate(fd, length);
}
```

### Example 4: Function with error handling

**Before:**

```js
const fs = require("node:fs");
function safeTruncate(fd, length, callback) {
  fs.truncate(fd, length, (err) => {
    if (err) {
      console.error("Truncation failed:", err);
      return callback(err);
    }
    callback(null);
  });
}
```

**After:**

```js
const fs = require("node:fs");
function safeTruncate(fd, length, callback) {
  fs.ftruncate(fd, length, (err) => {
    if (err) {
      console.error("Truncation failed:", err);
      return callback(err);
    }
    callback(null);
  });
}
```

### Example 5: ESM import usage

**Before:**

```js
import { open, truncate, close } from "node:fs";
open("file.txt", "r+", (err, fd) => {
  if (!err) {
    truncate(fd, 50, () => close(fd, () => {}));
  }
});
```

**After:**

```js
import { open, ftruncate, close } from "node:fs";
open("file.txt", "r+", (err, fd) => {
  if (!err) {
    ftruncate(fd, 50, () => close(fd, () => {}));
  }
});
```

### Example 6: Class method with file operations

**Before:**

```js
const fs = require("node:fs");
class FileManager {
  truncateByDescriptor(fd, size) {
    return new Promise((resolve, reject) => {
      fs.truncate(fd, size, (err) => {
        if (err) reject(err);
        else resolve();
      });
    });
  }
}
```

**After:**

```js
const fs = require("node:fs");
class FileManager {
  truncateByDescriptor(fd, size) {
    return new Promise((resolve, reject) => {
      fs.ftruncate(fd, size, (err) => {
        if (err) reject(err);
        else resolve();
      });
    });
  }
}
```

## Refs

- [DEP0081: `fs.truncate()` using a file descriptor](https://nodejs.org/api/deprecations.html#dep0081)